@rendermode InteractiveServer
@page "/"
@inject IDialogService DialogService
@inject NavigationManager NavigationManager
@inject SpotifyAuthService SpotifyAuthService


<PageTitle>Home</PageTitle>


@if (service == null){
    <MudButton Color="Color.Primary" Variant="Variant.Filled" Href="/auth">Connect to Spotify</MudButton>
}
else{
    <MudPaper Width="100%">
        <MusicPlayer Player="service"/>
    </MudPaper>
}

@code {
    SpotifyService? service;
    protected override async Task OnInitializedAsync()
    {
        var tempService = await SpotifyAuthService.CreateFromCache();

        if (tempService == null)
        {
            return;
        }

        var isStillConnected = await tempService.GetIsStillConnected();

        if (!isStillConnected)
        {
            return;
        }

        service = tempService;
    }
}